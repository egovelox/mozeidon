(()=>{"use strict";var e={859:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(s,a){function i(e){try{c(o.next(e))}catch(e){a(e)}}function r(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,r)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=n(28),a=n(920),i=n(614),r=n(185);(0,i.log)(`Starting ${s.ADDON_NAME} add-on`);let c=browser.runtime.connectNative(s.ADDON_NAME);(0,i.log)(`[${s.ADDON_NAME}] Connected with native application`,c),function e(t){t.onMessage.addListener((e=>{(0,i.log)(`[${s.ADDON_NAME}] Got message from native application: ${JSON.stringify(e)}`);const{payload:n}=e;(0,a.handler)(t,n)})),t.onDisconnect.addListener((t=>o(this,void 0,void 0,(function*(){(0,i.log)(`[${s.ADDON_NAME}] Disconnected with native application`),(0,i.log)(`[${s.ADDON_NAME}] Broken port ?`,t);(0,i.log)(`[${s.ADDON_NAME}] Waiting 1000ms before retry...`),yield(0,r.delay)(1e3),(0,i.log)(`[${s.ADDON_NAME}] Waited 1000ms...`),(0,i.log)(`[${s.ADDON_NAME}] Trying to reconnect to native application...`),t=browser.runtime.connectNative(s.ADDON_NAME),(0,i.log)(`[${s.ADDON_NAME}] Connected with native application`,t),e(t)}))))}(c)},28:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEBUG=t.ADDON_NAME=void 0,t.ADDON_NAME="mozeidon",t.DEBUG=!1},921:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_BOOKMARK_COUNT=t.BOOKMARK_TYPE=t.ROOT_BOOKMARK_ID=void 0,t.ROOT_BOOKMARK_ID="toolbar_____",t.BOOKMARK_TYPE="bookmark",t.MAX_BOOKMARK_COUNT=1e5},920:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(s,a){function i(e){try{c(o.next(e))}catch(e){a(e)}}function r(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,r)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.handler=void 0;const s=n(238),a=n(972),i=n(721);t.handler=function(e,t){return o(this,void 0,void 0,(function*(){switch(t.command){case s.CommandName.GET_TABS:return(0,i.getTabs)(e,t);case s.CommandName.GET_RECENTLY_CLOSED_TABS:return(0,i.getRecentlyClosedTabs)(e,t);case s.CommandName.SWITCH_TAB:return(0,i.switchToTab)(e,t);case s.CommandName.CLOSE_TABS:return(0,i.closeTabs)(e,t);case s.CommandName.NEW_TAB:return yield(0,i.newTab)(e,t);case s.CommandName.GET_BOOKMARKS:return(0,a.getBookmarks)(e,t)}}))}},614:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.log=void 0;const o=n(28);t.log=function(...e){o.DEBUG&&console.log.apply(console,e)}},238:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.CommandName=void 0,function(e){e.CLOSE_TABS="close-tabs",e.GET_BOOKMARKS="get-bookmarks",e.GET_RECENTLY_CLOSED_TABS="get-recently-closed-tabs",e.GET_TABS="get-tabs",e.NEW_TAB="new-tab",e.SWITCH_TAB="switch-tab"}(n||(t.CommandName=n={}))},392:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Response=void 0;class n{constructor(e){return{data:e}}static data(e){return new n(e)}static end(){return new n("end")}}t.Response=n},972:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(s,a){function i(e){try{c(o.next(e))}catch(e){a(e)}}function r(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,r)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getBookmarks=void 0;const s=n(921),a=n(614),i=n(392),r=n(185),c=new Map;function d(e){return o(this,void 0,void 0,(function*(){const t=[];for(const n of yield function(e){return o(this,void 0,void 0,(function*(){const t=[],{complete:n,uncomplete:o}=e.reduce(((e,t)=>(t.parentId!==s.ROOT_BOOKMARK_ID?e.uncomplete.push(t):e.complete.push(Object.assign(Object.assign({},t),{parentPath:""})),e)),{complete:[],uncomplete:[]});let a=o.reduce(((e,t)=>{if(t.parentId){const n=e.get(t.parentId);n?n.addNew(t):e.set(t.parentId,new l(t))}return e}),new Map);for(const[e,n]of a){let o=e;for(;!n.ok;){let e=c.get(o);e||(e=(yield browser.bookmarks.get(o))[0],c.set(e.id,e)),!e||void 0!==e.parentId&&e.parentId!==s.ROOT_BOOKMARK_ID&&""!==e.title?(n.addParent(e.title),o=e.parentId):n.setOk().addParent(e.title)}for(const e of n.bookmarks)t.push(Object.assign(Object.assign({},e),{parentPath:n.parentPath.filter((e=>e)).join("/")}));a.delete(e)}t.push(...n);return t.sort(((e,t)=>((e,t)=>e>t?-1:1)(e.dateAdded||0,t.dateAdded||0))),t}))}(e.filter((e=>e.url&&e.type===s.BOOKMARK_TYPE))))t.push({id:n.id,title:n.title,url:n.url,parent:n.parentPath});return t}))}t.getBookmarks=function(e,{args:t}){if(!t)return(0,a.log)("missing args in get-bookmarks"),e.postMessage(i.Response.end());const n=t.split(":");if(n.length<2)return(0,a.log)(`invalid args in get-bookmarks: received ${t}, expected a string combining two integers like "0:0"`),e.postMessage(i.Response.end());const c=parseInt(n[0]),l=parseInt(n[1]);browser.bookmarks.getRecent(c||s.MAX_BOOKMARK_COUNT).then((t=>o(this,void 0,void 0,(function*(){const n=Date.now(),o=l||s.MAX_BOOKMARK_COUNT,c=[];for(let e=0;e<t.length;e+=o){const n=t.slice(e,e+o);c.push(n)}for(const t of c){const n=yield d(t);e.postMessage(i.Response.data(n))}const u=Date.now();(0,a.log)(`sending back bookmarks in ${u-n} ms`),yield(0,r.delay)(100),e.postMessage(i.Response.end())}))))};class l{constructor(e){this.ok=!1,this.bookmarks=[],this.parentPath=[],this.bookmarks.push(e)}addNew(e){this.bookmarks.push(e)}setOk(){return this.ok=!0,this}addParent(e){this.parentPath=[e,...this.parentPath]}}},721:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(s,a){function i(e){try{c(o.next(e))}catch(e){a(e)}}function r(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,r)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.closeTabs=t.switchToTab=t.getTabs=t.getRecentlyClosedTabs=t.newTab=void 0;const s=n(614),a=n(392),i=n(185);t.newTab=function(e,{args:t}){return o(this,void 0,void 0,(function*(){if(!t)return(0,s.log)("open empty tab"),yield browser.tabs.create({}),e.postMessage(a.Response.end());try{const e=new URL(t);(0,s.log)("open tab at url: ",e),yield browser.tabs.create({url:e.toString()})}catch(e){const n=`https://www.google.com/search?q=${encodeURIComponent(t)}`;(0,s.log)("open google tab"),yield browser.tabs.create({url:n})}e.postMessage(a.Response.end())}))},t.getRecentlyClosedTabs=function(e,{command:t}){browser.sessions.getRecentlyClosed().then((t=>o(this,void 0,void 0,(function*(){const n=t.sort(((e,t)=>t.lastModified-e.lastModified)).filter((e=>e.tab)).map((e=>e.tab)).filter((e=>!!e));(0,s.log)("Sending back ",n.length," recently closed tabs");const o=n.map((e=>{var t;return{id:null!==(t=e.lastAccessed)&&void 0!==t?t:Math.floor(1e3*Math.random()),windowId:e.windowId,title:e.title,pinned:e.pinned,url:e.url,active:e.active,domain:e.url?new URL(e.url).hostname.replace("www.",""):""}}));e.postMessage(a.Response.data(o)),yield(0,i.delay)(100),e.postMessage(a.Response.end())}))))},t.getTabs=function(e,{command:t}){browser.tabs.query({}).then((t=>o(this,void 0,void 0,(function*(){let n=t.slice();t.sort(((e,t)=>t.lastAccessed-e.lastAccessed));const o=t.slice(0,10);n=[...o,...n.filter((e=>!o.includes(e)))],(0,s.log)("Sending back ",n.length," tabs");const r=n.map((e=>({id:e.id,windowId:e.windowId,title:e.title,pinned:e.pinned,url:e.url,active:e.active,domain:e.url?new URL(e.url).hostname.replace("www.",""):""})));e.postMessage(a.Response.data(r)),yield(0,i.delay)(100),e.postMessage(a.Response.end())}))))},t.switchToTab=function(e,{args:t}){if(!t)return(0,s.log)("invalid args, received: ",t),e.postMessage(a.Response.end());let n,o;const i=t.split(":");if(2!==i.length)return(0,s.log)("invalid args, cannot find both window and tab ids. Received: ",t),e.postMessage(a.Response.end());try{n=Number.parseInt(i[0]),o=Number.parseInt(i[1])}catch(n){return(0,s.log)("invalid args, cannot parse both window and tab ids as int",t),e.postMessage(a.Response.end())}browser.tabs.query({windowId:n}).then((e=>{for(let t of e)if(t.id===o){(0,s.log)("found tab to switch to",t),browser.tabs.update(t.id,{active:!0});break}})),e.postMessage(a.Response.end())},t.closeTabs=function(e,{args:t}){if(!t)return(0,s.log)("invalid args, received: ",t),e.postMessage(a.Response.end());const n=[],o=t.split(",");browser.tabs.query({}).then((e=>{for(let t of e)t.id&&o.some((e=>`${t.windowId}:${t.id}`===e))&&((0,s.log)("found tab to close",t),n.push(t.id));(0,s.log)("closing tabs",n),browser.tabs.remove(n)})),e.postMessage(a.Response.end())}},185:function(e,t){var n=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(s,a){function i(e){try{c(o.next(e))}catch(e){a(e)}}function r(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,r)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.delay=void 0,t.delay=function(e){return n(this,void 0,void 0,(function*(){return new Promise((t=>setTimeout(t,e)))}))}}},t={};!function n(o){var s=t[o];if(void 0!==s)return s.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,n),a.exports}(859)})();