(()=>{"use strict";var t={28:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ADDON_NAME=void 0,e.ADDON_NAME="mozeidon"},920:function(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,a){function s(t){try{c(o.next(t))}catch(t){a(t)}}function i(t){try{c(o.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,i)}c((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.handler=void 0;const r=n(972),a=n(721);e.handler=function(t,e){return o(this,void 0,void 0,(function*(){switch(e.command){case"get-tabs":return(0,a.getTabs)(t,e);case"switch-tab":return(0,a.switchToTab)(t,e);case"close-tabs":return(0,a.closeTabs)(t,e);case"open-tab":return yield(0,a.openTab)(t,e);case"get-bookmarks":return(0,r.getRecentBookmarks)(t,e);default:console.error("Cannot handle unknown command: ",e.command)}}))}},972:function(t,e){var n=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,a){function s(t){try{c(o.next(t))}catch(t){a(t)}}function i(t){try{c(o.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,i)}c((o=o.apply(t,e||[])).next())}))};function o(t){return n(this,void 0,void 0,(function*(){const e=[];for(const n of t){if(!n.url||"bookmark"!==n.type)continue;const t=yield r(n);e.push({title:n.title,url:n.url,parent:t.join(",")})}return e}))}function r(t){return n(this,void 0,void 0,(function*(){let e="toolbar_____"!==t.parentId,n=t,o=[];for(;e&&n.parentId;){let t=yield browser.bookmarks.get(n.parentId);t.length&&t[0].title?(o.push(t[0].title),n=t[0],e="toolbar_____"!==t[0].parentId):e=!1}return o}))}Object.defineProperty(e,"__esModule",{value:!0}),e.getRecentBookmarks=void 0,e.getRecentBookmarks=function(t,{command:e}){browser.bookmarks.getRecent(1e4).then((e=>n(this,void 0,void 0,(function*(){const n=Date.now(),r=[];for(let t=0;t<e.length;t+=300){const n=e.slice(t,t+300);r.push(o(n))}let a=[];(yield Promise.all(r)).forEach((t=>{a=a.concat(t)}));const s=Date.now();console.log(`sending back ${a.length} bookmarks in ${s-n}`),t.postMessage({data:a})}))))}},721:function(t,e){var n=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,a){function s(t){try{c(o.next(t))}catch(t){a(t)}}function i(t){try{c(o.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,i)}c((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.closeTabs=e.switchToTab=e.getTabs=e.openTab=void 0,e.openTab=function(t,{args:e}){return n(this,void 0,void 0,(function*(){try{const t=new URL(e);console.log("open tab"),yield browser.tabs.create({url:t.toString()})}catch(t){console.log("open google tab"),yield browser.tabs.create({url:`https://www.google.com/search?q=${e}`})}t.postMessage({data:null})}))},e.getTabs=function(t,{command:e}){browser.tabs.query({currentWindow:!0}).then((e=>{let n=e.slice();e.sort(((t,e)=>e.lastAccessed-t.lastAccessed));const o=e.slice(0,5);n=[...o,...n.filter((t=>!o.includes(t)))],console.log("Sending back ",n.length," tabs");const r={data:n.map((t=>({id:t.id,title:t.title,pinned:t.pinned,domain:t.url?new URL(t.url).hostname.replace("www.",""):""})))};t.postMessage(r)}))},e.switchToTab=function(t,{args:e}){browser.tabs.query({currentWindow:!0}).then((t=>{for(let n of t)if(n.id==e){console.log("found tab to switch to",n),browser.tabs.update(n.id,{active:!0});break}})),t.postMessage({data:null})},e.closeTabs=function(t,{args:e}){browser.tabs.query({currentWindow:!0}).then((t=>{const n=[],o=e.split(",");for(let e of t)e.id&&o.some((t=>`${e.id}`===t))&&(console.log("found tab to close",e),n.push(e.id));browser.tabs.remove(n)})),t.postMessage({data:null})}}},e={};function n(o){var r=e[o];if(void 0!==r)return r.exports;var a=e[o]={exports:{}};return t[o].call(a.exports,a,a.exports,n),a.exports}(()=>{const t=n(28),e=n(920);console.log(`Starting ${t.ADDON_NAME} add-on`),function(t){let n=browser.runtime.connectNative(t);console.log(`[${t}] Connected with native application`,n),n.onMessage.addListener((o=>{console.log(`[${t}] Got message from native application: ${JSON.stringify(o)}`);const{payload:r}=o;(0,e.handler)(n,r)}))}(t.ADDON_NAME)})()})();