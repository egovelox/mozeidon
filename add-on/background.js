(()=>{"use strict";var t={28:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DEBUG=e.ADDON_NAME=void 0,e.ADDON_NAME="mozeidon",e.DEBUG=!1},920:function(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(s,a){function r(t){try{c(o.next(t))}catch(t){a(t)}}function i(t){try{c(o.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,i)}c((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.handler=void 0;const s=n(972),a=n(721);e.handler=function(t,e){return o(this,void 0,void 0,(function*(){switch(e.command){case"get-tabs":return(0,a.getTabs)(t,e);case"switch-tab":return(0,a.switchToTab)(t,e);case"close-tabs":return(0,a.closeTabs)(t,e);case"open-tab":return yield(0,a.openTab)(t,e);case"get-bookmarks":return(0,s.getRecentBookmarks)(t,e);default:console.error("Cannot handle unknown command: ",e.command)}}))}},614:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.log=void 0;const o=n(28);e.log=function(...t){o.DEBUG&&console.log.apply(console,t)}},972:function(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(s,a){function r(t){try{c(o.next(t))}catch(t){a(t)}}function i(t){try{c(o.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,i)}c((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.getRecentBookmarks=void 0;const s=n(614);function a(t){return o(this,void 0,void 0,(function*(){const e=[];for(const n of t){if(!n.url||"bookmark"!==n.type)continue;const t=yield r(n);e.push({title:n.title,url:n.url,parent:t.join(",")})}return e}))}function r(t){return o(this,void 0,void 0,(function*(){let e="toolbar_____"!==t.parentId,n=t,o=[];for(;e&&n.parentId;){let t=yield browser.bookmarks.get(n.parentId);t.length&&t[0].title?(o.push(t[0].title),n=t[0],e="toolbar_____"!==t[0].parentId):e=!1}return o}))}e.getRecentBookmarks=function(t,{command:e}){browser.bookmarks.getRecent(5e4).then((e=>o(this,void 0,void 0,(function*(){const n=Date.now(),o=[];for(let t=0;t<e.length;t+=800){const n=e.slice(t,t+800);o.push(n)}for(const e of o){const n=yield a(e);t.postMessage({data:n})}const r=Date.now();(0,s.log)(`sending back bookmarks in ${r-n} ms`),yield new Promise((t=>setTimeout(t,100))),t.postMessage({data:"end"})}))))}},721:function(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(s,a){function r(t){try{c(o.next(t))}catch(t){a(t)}}function i(t){try{c(o.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,i)}c((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.closeTabs=e.switchToTab=e.getTabs=e.openTab=void 0;const s=n(614);e.openTab=function(t,{args:e}){return o(this,void 0,void 0,(function*(){try{const t=new URL(e);(0,s.log)("open tab"),yield browser.tabs.create({url:t.toString()})}catch(t){(0,s.log)("open google tab"),yield browser.tabs.create({url:`https://www.google.com/search?q=${e}`})}t.postMessage({data:"end"})}))},e.getTabs=function(t,{command:e}){browser.tabs.query({currentWindow:!0}).then((e=>o(this,void 0,void 0,(function*(){let n=e.slice();e.sort(((t,e)=>e.lastAccessed-t.lastAccessed));const o=e.slice(0,10);n=[...o,...n.filter((t=>!o.includes(t)))],(0,s.log)("Sending back ",n.length," tabs");const a={data:n.map((t=>({id:t.id,title:t.title,pinned:t.pinned,domain:t.url?new URL(t.url).hostname.replace("www.",""):""})))};t.postMessage(a),yield new Promise((t=>setTimeout(t,100))),t.postMessage({data:"end"})}))))},e.switchToTab=function(t,{args:e}){browser.tabs.query({currentWindow:!0}).then((t=>{for(let n of t)if(n.id==e){console.log("found tab to switch to",n),browser.tabs.update(n.id,{active:!0});break}})),t.postMessage({data:"end"})},e.closeTabs=function(t,{args:e}){browser.tabs.query({currentWindow:!0}).then((t=>{const n=[],o=e.split(",");for(let e of t)e.id&&o.some((t=>`${e.id}`===t))&&((0,s.log)("found tab to close",e),n.push(e.id));(0,s.log)("closing tabs",n),browser.tabs.remove(n)})),t.postMessage({data:"end"})}}},e={};function n(o){var s=e[o];if(void 0!==s)return s.exports;var a=e[o]={exports:{}};return t[o].call(a.exports,a,a.exports,n),a.exports}(()=>{const t=n(28),e=n(920),o=n(614);(0,o.log)(`Starting ${t.ADDON_NAME} add-on`),function(t){let n=browser.runtime.connectNative(t);(0,o.log)(`[${t}] Connected with native application`,n),n.onMessage.addListener((s=>{(0,o.log)(`[${t}] Got message from native application: ${JSON.stringify(s)}`);const{payload:a}=s;(0,e.handler)(n,a)}))}(t.ADDON_NAME)})()})();