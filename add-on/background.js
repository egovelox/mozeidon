(()=>{"use strict";var e={28:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEBUG=t.ADDON_NAME=void 0,t.ADDON_NAME="mozeidon",t.DEBUG=!0},921:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BOOKMARK_TYPE=t.ROOT_BOOKMARK_ID=void 0,t.ROOT_BOOKMARK_ID="toolbar_____",t.BOOKMARK_TYPE="bookmark"},920:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(s,a){function i(e){try{c(o.next(e))}catch(e){a(e)}}function r(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,r)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.handler=void 0;const s=n(238),a=n(972),i=n(721);t.handler=function(e,t){return o(this,void 0,void 0,(function*(){switch(t.command){case s.CommandName.GET_TABS:return(0,i.getTabs)(e,t);case s.CommandName.GET_RECENTLY_CLOSED_TABS:return(0,i.getRecentlyClosedTabs)(e,t);case s.CommandName.SWITCH_TAB:return(0,i.switchToTab)(e,t);case s.CommandName.CLOSE_TABS:return(0,i.closeTabs)(e,t);case s.CommandName.NEW_TAB:return yield(0,i.newTab)(e,t);case s.CommandName.GET_BOOKMARKS:return(0,a.getBookmarks)(e,t);default:console.error("Cannot handle unknown command: ",t.command)}}))}},614:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.log=void 0;const o=n(28);t.log=function(...e){o.DEBUG&&console.log.apply(console,e)}},238:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.CommandName=void 0,function(e){e.GET_TABS="get-tabs",e.GET_RECENTLY_CLOSED_TABS="get-recently-closed-tabs",e.GET_BOOKMARKS="get-bookmarks",e.CLOSE_TABS="close-tabs",e.NEW_TAB="new-tab",e.SWITCH_TAB="switch-tab"}(n||(t.CommandName=n={}))},392:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Response=void 0;class n{constructor(e){return{data:e}}static data(e){return new n(e)}static end(){return new n("end")}}t.Response=n},972:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(s,a){function i(e){try{c(o.next(e))}catch(e){a(e)}}function r(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,r)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getBookmarks=void 0;const s=n(921),a=n(614),i=n(392);function r(e){return o(this,void 0,void 0,(function*(){const t=[];for(const n of e){if(!n.url||n.type!==s.BOOKMARK_TYPE)continue;const e=yield c(n);t.push({id:n.id,title:n.title,url:n.url,parent:e.join(",")})}return t}))}function c(e){return o(this,void 0,void 0,(function*(){let t=e.parentId!==s.ROOT_BOOKMARK_ID,n=e,o=[];for(;t&&n.parentId;){let e=yield browser.bookmarks.get(n.parentId);e.length&&e[0].title?(o.push(e[0].title),n=e[0],t=e[0].parentId!==s.ROOT_BOOKMARK_ID):t=!1}return o}))}t.getBookmarks=function(e,{command:t}){browser.bookmarks.getRecent(5e4).then((t=>o(this,void 0,void 0,(function*(){const n=Date.now(),o=[];for(let e=0;e<t.length;e+=500){const n=t.slice(e,e+500);o.push(n)}for(const t of o){const n=yield r(t);e.postMessage(i.Response.data(n))}const s=Date.now();(0,a.log)(`sending back bookmarks in ${s-n} ms`),yield new Promise((e=>setTimeout(e,100))),e.postMessage(i.Response.end())}))))}},721:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(s,a){function i(e){try{c(o.next(e))}catch(e){a(e)}}function r(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,r)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.closeTabs=t.switchToTab=t.getTabs=t.getRecentlyClosedTabs=t.newTab=void 0;const s=n(614),a=n(392);t.newTab=function(e,{args:t}){return o(this,void 0,void 0,(function*(){if(!t)return(0,s.log)("open empty tab"),yield browser.tabs.create({}),e.postMessage(a.Response.end());try{const e=new URL(t);(0,s.log)("open tab: ",e),yield browser.tabs.create({url:e.toString()})}catch(e){const n=`https://www.google.com/search?q=${t}`;(0,s.log)("open google tab"),yield browser.tabs.create({url:n})}e.postMessage(a.Response.end())}))},t.getRecentlyClosedTabs=function(e,{command:t}){browser.sessions.getRecentlyClosed().then((t=>o(this,void 0,void 0,(function*(){const n=t.sort(((e,t)=>t.lastModified-e.lastModified)).filter((e=>e.tab)).map((e=>e.tab)).filter((e=>!!e));(0,s.log)("Sending back ",n.length," recently closed tabs");const o=n.map((e=>{var t;return{id:null!==(t=e.lastAccessed)&&void 0!==t?t:Math.floor(1e3*Math.random()),windowId:e.windowId,title:e.title,pinned:e.pinned,url:e.url,active:e.active,domain:e.url?new URL(e.url).hostname.replace("www.",""):""}}));e.postMessage(a.Response.data(o)),yield new Promise((e=>setTimeout(e,100))),e.postMessage(a.Response.end())}))))},t.getTabs=function(e,{command:t}){browser.tabs.query({}).then((t=>o(this,void 0,void 0,(function*(){let n=t.slice();t.sort(((e,t)=>t.lastAccessed-e.lastAccessed));const o=t.slice(0,10);n=[...o,...n.filter((e=>!o.includes(e)))],(0,s.log)("Sending back ",n.length," tabs");const i=n.map((e=>({id:e.id,windowId:e.windowId,title:e.title,pinned:e.pinned,url:e.url,active:e.active,domain:e.url?new URL(e.url).hostname.replace("www.",""):""})));e.postMessage(a.Response.data(i)),yield new Promise((e=>setTimeout(e,100))),e.postMessage(a.Response.end())}))))},t.switchToTab=function(e,{args:t}){if(!t)return(0,s.log)("invalid args, received: ",t),e.postMessage(a.Response.end());let n,o;const i=t.split(":");if(2!==i.length)return(0,s.log)("invalid args, cannot find both window and tab ids. Received: ",t),e.postMessage(a.Response.end());try{n=Number.parseInt(i[0]),o=Number.parseInt(i[1])}catch(n){return(0,s.log)("invalid args, cannot parth both window and tab ids as int",t),e.postMessage(a.Response.end())}browser.tabs.query({windowId:n}).then((e=>{for(let t of e)if(t.id==o){(0,s.log)("found tab to switch to",t),browser.tabs.update(t.id,{active:!0});break}})),e.postMessage(a.Response.end())},t.closeTabs=function(e,{args:t}){if(!t)return(0,s.log)("invalid args, received: ",t),e.postMessage(a.Response.end());const n=[],o=t.split(",");browser.tabs.query({}).then((e=>{for(let t of e)t.id&&o.some((e=>`${t.windowId}:${t.id}`===e))&&((0,s.log)("found tab to close",t),n.push(t.id));(0,s.log)("closing tabs",n),browser.tabs.remove(n)})),e.postMessage(a.Response.end())}}},t={};function n(o){var s=t[o];if(void 0!==s)return s.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,n),a.exports}(()=>{const e=n(28),t=n(920),o=n(614);(0,o.log)(`Starting ${e.ADDON_NAME} add-on`),function(e){let n=browser.runtime.connectNative(e);(0,o.log)(`[${e}] Connected with native application`,n),n.onMessage.addListener((s=>{(0,o.log)(`[${e}] Got message from native application: ${JSON.stringify(s)}`);const{payload:a}=s;(0,t.handler)(n,a)}))}(e.ADDON_NAME)})()})();