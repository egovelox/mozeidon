(()=>{"use strict";var e={28:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEBUG=t.ADDON_NAME=void 0,t.ADDON_NAME="mozeidon",t.DEBUG=!0},920:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(a,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function r(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,r)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.handler=void 0;const a=n(972),s=n(721);t.handler=function(e,t){return o(this,void 0,void 0,(function*(){switch(t.command){case"get-tabs":return(0,s.getTabs)(e,t);case"get-recently-closed-tabs":return(0,s.getRecentlyClosedTabs)(e,t);case"switch-tab":return(0,s.switchToTab)(e,t);case"close-tabs":return(0,s.closeTabs)(e,t);case"new-tab":return yield(0,s.newTab)(e,t);case"get-bookmarks":return(0,a.getRecentBookmarks)(e,t);default:console.error("Cannot handle unknown command: ",t.command)}}))}},614:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.log=void 0;const o=n(28);t.log=function(...e){o.DEBUG&&console.log.apply(console,e)}},972:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(a,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function r(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,r)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getRecentBookmarks=void 0;const a=n(614);function s(e){return o(this,void 0,void 0,(function*(){const t=[];for(const n of e){if(!n.url||"bookmark"!==n.type)continue;const e=yield i(n);t.push({id:n.id,title:n.title,url:n.url,parent:e.join(",")})}return t}))}function i(e){return o(this,void 0,void 0,(function*(){let t="toolbar_____"!==e.parentId,n=e,o=[];for(;t&&n.parentId;){let e=yield browser.bookmarks.get(n.parentId);e.length&&e[0].title?(o.push(e[0].title),n=e[0],t="toolbar_____"!==e[0].parentId):t=!1}return o}))}t.getRecentBookmarks=function(e,{command:t}){browser.bookmarks.getRecent(5e4).then((t=>o(this,void 0,void 0,(function*(){const n=Date.now(),o=[];for(let e=0;e<t.length;e+=200){const n=t.slice(e,e+200);o.push(n)}for(const t of o){const n=yield s(t);e.postMessage({data:n})}const i=Date.now();(0,a.log)(`sending back bookmarks in ${i-n} ms`),yield new Promise((e=>setTimeout(e,100))),e.postMessage({data:"end"})}))))}},721:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(a,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function r(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,r)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.closeTabs=t.switchToTab=t.getTabs=t.getRecentlyClosedTabs=t.newTab=void 0;const a=n(614);t.newTab=function(e,{args:t}){return o(this,void 0,void 0,(function*(){if(!t)return(0,a.log)("open empty tab"),yield browser.tabs.create({}),e.postMessage({data:"end"});try{const e=new URL(t);(0,a.log)("open tab: ",e),yield browser.tabs.create({url:e.toString()})}catch(e){const n=`https://www.google.com/search?q=${t}`;(0,a.log)("open google tab"),yield browser.tabs.create({url:n})}e.postMessage({data:"end"})}))},t.getRecentlyClosedTabs=function(e,{command:t}){browser.sessions.getRecentlyClosed().then((t=>o(this,void 0,void 0,(function*(){const n=t.sort(((e,t)=>t.lastModified-e.lastModified)).filter((e=>e.tab)).map((e=>e.tab)).filter((e=>!!e));(0,a.log)("Sending back ",n.length," recently closed tabs");const o={data:n.map((e=>{var t;return{id:null!==(t=e.lastAccessed)&&void 0!==t?t:Math.floor(1e3*Math.random()),windowId:e.windowId,title:e.title,pinned:e.pinned,url:e.url,active:e.active,domain:e.url?new URL(e.url).hostname.replace("www.",""):""}}))};e.postMessage(o),yield new Promise((e=>setTimeout(e,100))),e.postMessage({data:"end"})}))))},t.getTabs=function(e,{command:t}){browser.tabs.query({}).then((t=>o(this,void 0,void 0,(function*(){let n=t.slice();t.sort(((e,t)=>t.lastAccessed-e.lastAccessed));const o=t.slice(0,10);n=[...o,...n.filter((e=>!o.includes(e)))],(0,a.log)("Sending back ",n.length," tabs");const s={data:n.map((e=>({id:e.id,windowId:e.windowId,title:e.title,pinned:e.pinned,url:e.url,active:e.active,domain:e.url?new URL(e.url).hostname.replace("www.",""):""})))};e.postMessage(s),yield new Promise((e=>setTimeout(e,100))),e.postMessage({data:"end"})}))))},t.switchToTab=function(e,{args:t}){if(!t)return(0,a.log)("invalid args, received: ",t),e.postMessage({data:"end"});let n,o;const s=t.split(":");if(2!==s.length)return(0,a.log)("invalid args, cannot find both window and tab ids. Received: ",t),e.postMessage({data:"end"});try{n=Number.parseInt(s[0]),o=Number.parseInt(s[1])}catch(n){return(0,a.log)("invalid args, cannot parth both window and tab ids as int",t),e.postMessage({data:"end"})}browser.tabs.query({windowId:n}).then((e=>{for(let t of e)if(t.id==o){(0,a.log)("found tab to switch to",t),browser.tabs.update(t.id,{active:!0});break}})),e.postMessage({data:"end"})},t.closeTabs=function(e,{args:t}){if(!t)return(0,a.log)("invalid args, received: ",t),e.postMessage({data:"end"});const n=[],o=t.split(",");browser.tabs.query({}).then((e=>{for(let t of e)t.id&&o.some((e=>`${t.windowId}:${t.id}`===e))&&((0,a.log)("found tab to close",t),n.push(t.id));(0,a.log)("closing tabs",n),browser.tabs.remove(n)})),e.postMessage({data:"end"})}}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,n),s.exports}(()=>{const e=n(28),t=n(920),o=n(614);(0,o.log)(`Starting ${e.ADDON_NAME} add-on`),function(e){let n=browser.runtime.connectNative(e);(0,o.log)(`[${e}] Connected with native application`,n),n.onMessage.addListener((a=>{(0,o.log)(`[${e}] Got message from native application: ${JSON.stringify(a)}`);const{payload:s}=a;(0,t.handler)(n,s)}))}(e.ADDON_NAME)})()})();